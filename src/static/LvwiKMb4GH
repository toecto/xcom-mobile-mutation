window.__jivoOnError=function(e){if(-1===navigator.userAgent.search(/google/gi)&&-1===navigator.userAgent.search(/\+http:\/\/yandex\.com\/bots/gi))try{var t=jivo_config&&jivo_config.base_url,o="main";t&&(-1!==t.indexOf("jvs")&&(o="jvs"),-1!==t.indexOf("ru1")&&(o="ru1"),-1!==t.indexOf("ya")&&(o="ya"));var n=window.location.protocol+"//err.jivosite.com/widget",r="POST",i={widget:"true",widget_version:window.jivo_version,level:2,url:window.location.href,user_agent:navigator.userAgent,lineNumber:e&&e.lineNumber,fileName:e&&e.fileName,column:e&&e.columnNumber,full_message:e&&e.stack,short_message:e&&e.message,shard:o},a=new XMLHttpRequest;"withCredentials"in a?a.open(r,n,!0):"undefined"!=typeof XDomainRequest&&(a=new XDomainRequest).open(r,n),a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify(i))}catch(e){}},function(){window.__hasStorage=!1;try{localStorage.setItem("testLocalStorage","ok"),localStorage.removeItem("testLocalStorage"),window.__hasStorage=!0}catch(e){}function t(i,a,e,t){var s=i.console;if(s||(s={log:function(){},error:function(){}}),i.WebSocket){if(void 0===i.jivo_magic_var){i.jivo_magic_var=!0;var l,d,c,o,u,f,r,g,v,m,p,h,b={hasStorage:i.__hasStorage,jivoLoaderVersion:e,loadScript:function(e,t){var o=t||a,n=o.getElementsByTagName("script")[0],r=o.createElement("script");ge(r),n.parentNode.insertBefore(r,n).src=e},currentLoaderVersionCache:t},n=navigator.userAgent.toLowerCase(),w=/iPhone|iPad|iPod|Android|Windows Phone/i.test(n),_=a.createElement("iframe"),y=a.createElement("div"),S=0,j=5e3,I=5,C=4,T=6048e5,N=0,E=0,H=[],L=[["//cdn-fr.jivosite.com"],["//cdn-cis.jivosite.com"],["//cdn-ca.jivosite.com"]],O=!1,A={0:["default"],1:["RU","KZ","UA","BY"],2:["US","CA","AG","BS","BB","BZ","HT","GT","HN","GD","DM","DO","MX","NI","PA","SV","LC","VC","KN","TT","JM","CR","CU","AR","BR","BO","VE","GY","CO","PY","PE","SR","UY","CL","EC","AU","VU","KI","MH","FM","NR","NZ","PW","PG","WS","SB","TK","TV","FJ","PH"]},B="",k="default",M=!1,R=Q(),x=["IR","IQ","LB","LY","CU","SO","SD","SY","ZW","YE"];_e("Initialization"),i.__jivoBundleOnLoad=function(e){clearTimeout(u),f=e;var t=((new Date).getTime()-g)/1e3;6<t&&$("loadTime",t);$("bundleLoaded",!0),$("buildNumber",l.build_number),_e("Bundle is loaded"),function(){o=a.body.lastChild,y.style&&(y.style.opacity="0",y.style.visibility="hidden");y.setAttribute("id","jivo-iframe-container"),y.appendChild(_),o?o.parentNode.insertBefore(y,o.nextSibling):a.body.appendChild(y);K()}()},i.__jivoBundleInit=function(e){e.loaderContext=b,function(){f=null;var e=function(e){if(e){var t=e.querySelectorAll&&e.querySelectorAll(".js-jivo-bundle");return t&&0<t.length?t:e.getElementsByClassName("js-jivo-bundle")}}(ye());{if(!e)throw s.error("Cannot get bundle script element"),new Error("Cannot get bundle script element");for(var t=0;t<e.length;t++)e[t].parentNode&&(e[t].parentNode.removeChild(e[t]),e[t]=null);e=null}}()},i.jivo_init=function(){S=0;var e=a.createEvent("Event");e.initEvent("jBeforeunload",!0,!0),i.dispatchEvent(e),z()},i.jivo_destroy=function(){S=0;var e=a.createEvent("Event");e.initEvent("jBeforeunload",!0,!0),i.dispatchEvent(e),delete i.jivo_magic_var,setTimeout(function(){y.parentNode.removeChild(y)},10)},b.getHostURL=he,b.loadConfig=G,b.store=R,b.setInStore=$;var W=!1,U=function(e){try{e.blockedURI&&-1!==e.blockedURI.indexOf("jivosite")&&(W=!0,a.removeEventListener("securitypolicyviolation",U))}catch(e){}}.bind(this);try{we(a,"securitypolicyviolation",U)}catch(e){}re(),function(){(R=Q()).geoWidgetInfo.widgetId&&(m=R.geoWidgetInfo.widgetId,R=Q(),v=R.configHost);$("isNewCode",M),b.store=R}();var D,P,q=null,X=!1;p&&(h=p.getAttribute("nonce")),m&&v?(_e("widgetId:",m,"configHost:",v),G(ne())):m&&v||(D="no_widget_id_or_confighost",P=5,Math.random()<=.01*P&&J(D),s.error("Failed to evaluate the widgetId or configHost"))}}else s.log("Not supported browser");function G(e,o){if(H.push(e),C<++E){_e("Config load limit is exceeded"),b.hasStorage&&localStorage.removeItem("jv_loader_info_"+m);var t=new Error("Config load limit is exceeded"),n="Config urls: "+H.join(";\r\n");try{t.stack=n}catch(e){t=new Error("Config load limit is exceeded. "+n)}i.__jivoOnError(t)}else if(_e("Loading config from",e),R.deletedInfo.widgetId&&R.deletedInfo.widgetId===m&&R.deletedInfo.resolveTime&&parseInt(R.deletedInfo.resolveTime)>=(new Date).getTime())s.error("This widget is permanently removed");else{var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status){var t=Ce(ve(r));t?(_e("Config is loaded",t),t.isDeleted?ce():o?(t.chat_mode=o.chat_mode,t.options=o.options,t.botmode=o.botmode,t.geoip=o.geoip,V(t,null)):function(i,a){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var e=ve(s),t=Ce(e);if(!t)throw new Error("Load widget status error");var o=s.getResponseHeader("X-BotMode"),n=s.getResponseHeader("X-GeoIP"),r=t.agents&&t.agents.length;_e("Status is loaded",t,o,n,r),i.botmode="yes"===o?"yes":null,i.geoip=n||";;;",i.chat_mode=r?"online":"offline",i.options=t.premium?888:0,a(t.config_updated_ts)}else if(0!==s.status)throw i.botmode=null,i.geoip=";;;",i.chat_mode="offline",i.options=0,a(null),new Error("Load widget status error: "+s.status)};var e=oe()+"//"+i.comet.host+"/widget/status/"+i.site_id+"/"+i.widget_id+"?rnd="+Math.random();s.open("GET",e,!0),s.send(null)}(t,function(e){V(t,e)})):ue()}else 0!==r.status&&ue()},r.open("GET",e,!0),r.send(null)}}function J(e){if(-1===navigator.userAgent.search(/google/gi)&&-1===navigator.userAgent.search(/\+http:\/\/yandex\.com\/bots/gi))try{var t=oe()+"//telemetry.jivosite.com/w?cb=loader",o={event:e,widget_id:m,t:(new Date).getTime()};for(var n in o)t+="&"+n+"="+encodeURIComponent(o[n]);var r=new XMLHttpRequest;"withCredentials"in r?r.open("GET",t,!0):"undefined"!=typeof XDomainRequest&&(r=new XDomainRequest).open("GET",t),r.send()}catch(e){}}function V(e,t){if(e.isDeleted)ce();else{if(e.config_updated_ts&&e.config_updated_ts<t)return R.configUpdatedTs=t,G(ne(),e);if(v!==e.base_url&&!X)return _e("Wrong config host",v),v=e.base_url,void G(ne());if(e.regions&&!R.isChatStarted){var o=function(e){var t,o,n=e.regions,r=de(e.geoip);if(n){for(var i=Object.keys(n),a=0;a<i.length;a++)for(var s=n[i[a]],l=0;l<s.length;l++)if(1!=s.length||"default"!==s[l]){var d=de(s[l]);if(r.country===d.country){if(r.region===d.region)return le(i[a],s[l],e.geoip);o||d.region||(o=le(i[a],s[l],e.geoip))}}else t=i[a];if(o)return o;if(t)return le(t,"default",e.geoip)}}(e);if(o.widgetId!==m)return _e("Wrong geo-widget widgetId",m),$("geoWidgetInfo",o),m=o.widgetId,void G(ne())}if((q=e.ab_segment)&&q.name&&q.host&&q.staticHost&&1!==e.site_id)if(_e("AB-testing segmentation is enabled in config"),X=function(e,t){var o=R.abTesting,n=!1;n=o&&o.name===e.name?o.match:function(e,t){if(_e('Check for criteria match of test "'+e.name+'"'),e.device){var o="desktop"!==(n=e.device)?"mobile"!==n?"all"===n&&(je()||Ie()):Ie():je()&&!Ie();if(!o)return _e('Segment "'+e.name+'" is NOT matched. Criteria: device'),!1}var n;if(e.locale){var r=e.locale===t.locale;if(!r)return _e('Segment "'+e.name+'" is NOT matched. Criteria: locale'),!1}if(e.percentage){var i=(a=e.percentage,Math.random()<=.01*a);if(!i)return _e('Segment "'+e.name+'" is NOT matched. Criteria: percentage'),!1}var a;return _e('Segment "'+e.name+'" is matched!'),!0}(e,t);return $("abTesting",{name:e.name,match:n}),n}(q,e)){_e("Ab-testing segment match! Segment:",q.name);var n="//"+q.host;_e('Setting new base_url. Was: "'+e.base_url+'". New: "'+n+'".'),e.base_url=n,_e('Setting new static_host. Was: "'+e.static_host+'". New: "'+q.staticHost+'".'),e.static_host=q.staticHost,$("availableHostInfo",{type:R.availableHostInfo.type,retriesCount:R.availableHostInfo.retriesCount,host:null})}else _e("Ab-testing segment is NOT matched");else $("abTesting",null),_e("AB-testing segmentation is NOT enabled in config"),$("configHost",v);!function(e){{if($("log",!!e.logs),i.jivo_config=l=e,void 0!==l.host_blacklist&&0<=l.host_blacklist.indexOf(i.location.host))throw _e("Host is blacklisted",i.location.host),new Error("Placing widget is forbidden on "+i.top.location.host);if(t=l.geoip.split(";")[0],0<=x.indexOf(t))return s.log("[Jivo]: Service unavailable for country")}var t;if(w&&l.disable_mobile)return _e("Mobile widget is disabled");{}l.static_host&&(~l.static_host.search(/\/\/cdn(-\w+)?.jivosite.com(\/\w)?/)||~l.static_host.search(/\/\/code(-\w+)?.jivosite.com(\/\w)?/))&&(O=!0);_e("isCdnProvider: ",O),"complete"==a.readyState?Z():R.bundleLoaded&&R.buildNumber==l.build_number?"interactive"==a.readyState?Z():we(i,"DOMContentLoaded",Z):($("bundleLoaded",!1),we(i,"load",Z))}(e)}}function Z(){_e("Widget initialization"),function(){if("string"==typeof l.geoip&&""!==l.geoip){var e=l.geoip.split(";")[0];null!==me(e)&&(k=e)}if(!pe()){$("availableHostInfo",{type:null,retriesCount:null,host:null}),$("buildNumber",null)}var t=l.static_host?l.static_host.split("/"):[];t=O?[t[2],t[3]]:t,B=t[1]?"/"+t[1]:"";var o=R.availableHostInfo;4<(N=o.retriesCount?o.retriesCount:N)&&(N=4);r=me(k)}(),function(){_e("Iframe initialization"),_.src="javascript:void(0)",_.role="presentation",_.allow="autoplay",_.title="Jivochat",_.setAttribute("name","jivo_container"),_.setAttribute("id","jivo_container"),_.setAttribute("frameborder","no"),h&&_.setAttribute("nonce",h);i.atob&&"complete"!==a.readyState?we(i,"load",z):z();we(i,"message",function(e){if(e&&e.data&&"object"==typeof e.data){var t,o,n=e.data;if("in_node_webkit"==n.name&&(t||(t=e.source,o=e.origin),t&&o)){i.jivo_cobrowse={source:t,origin:o};var r="jv_"+encodeURIComponent("langpack")+"_"+l.widget_id+"="+encodeURIComponent(Te(n.langpack));l.cookie_domain&&(r+="; domain="+l.cookie_domain),r+="; path=/",a.cookie=r,t.postMessage({name:"widget_ready"},o)}"iframe_url_changed"!=n.name&&"iframe_url_changed"!=n||K()}else l&&1===l.logs&&s&&s.log&&s.log("Error receive postMessage, window message event is empty.")})}()}function z(){var e=he();_e("startLoadBundle",e),(l.build_number===R.buildNumber||e===l.base_url)&&(pe()||e===l.base_url)?F(e):Y(e)}function Y(e){var t={type:X?null:R.availableHostInfo.type,retriesCount:X?null:N,host:X?null:e};if(O)return _e("Do not ping cdn-provider",e),$("availableHostInfo",t),$("buildNumber",l.build_number),F(e);var o=new XMLHttpRequest,n=oe()+he(!0)+"/ping?rand="+(new Date).getTime();_e("Pinging host",n),o.onreadystatechange=function(){4===o.readyState&&(204===o.status?(clearTimeout(u),_e("Host is available",e),$("availableHostInfo",t),$("buildNumber",l.build_number),F(e)):0!==o.status&&(_e("Ping host error",e),be("error",e,o.status)))},o.open("GET",n,!0),o.send(null),u=setTimeout(function(){be("timeout")},j)}function F(e){_e("Insertion of bundle code from",e);var t,o,n=ye(),r=a.createElement("script"),i=(t=e,o=l.bundle_folder?l.bundle_folder:"",t+o+"/js/bundle_"+l.locale+".js?rand="+l.build_number);g=(new Date).getTime(),ge(r),r.className="js-jivo-bundle",r.src=oe()+i,b.bundleSrc=i,r.onerror=function(){_e("loadBundle errorBundle",e),a.getElementById("jcont")&&be("errorBundle",e)},n.appendChild(r)}function K(){if(!(3<S++)){if(!f)return S--,z();try{c=_.contentWindow.document}catch(e){d=a.domain,_.src="javascript:var d=document.open();d.domain='"+d+"';void(0);",c=_.contentWindow.document}var e='<meta name="google" content="notranslate"><meta http-equiv="X-UA-Compatible" content="IE=edge" />',t="window.onerror = function (message, url, lineNumber, columnNumber, error) {    if (error && error.error) {        error = error.error;    }    if (!error || !(error instanceof Error)) {        error = {};    }    if (error.stack) {        error.stack = error.message + ' ' + error.stack;    }    error.message = 'Bundle init error';    error.columnNumber = columnNumber;    error.lineNumber = lineNumber;    error.url = url;    window.parent.__jivoOnError(error);};"+f;if(c.head&&c.body){c.body.class="notranslate",c.head.innerHTML=e;var o=a.createElement("script");o.type="text/javascript",h&&o.setAttribute("nonce",h),o.innerHTML=t,c.head.appendChild(o)}else{var n='<body class="notranslate"></body>',r='<script type="text/javascript" nonce="'+h+'">'+t+"<\/script>",i="<head>"+e+r+"</head>";c.write("<!doctype HTML>"+i+n),i=n=r=null}c.close(),t=null}}function Q(){var e={isChatStarted:null,geoWidgetInfo:{widgetId:null,clientLocation:null,region:null},configHost:null,deletedInfo:{widgetId:null,resolveTime:null},availableHostInfo:{retriesCount:null,type:null,host:null},abTesting:null,buildNumber:null,bundleLoaded:null,isNewCode:null,loadTime:null,log:null,configUpdatedTs:null};if(b.hasStorage&&(localStorage.removeItem("jv_loader_info"),m)){var t=Ce(localStorage.getItem("jv_loader_info_"+m));t&&ee(t,e)}return e}function $(e,t){if(R[e]=t,b.hasStorage&&m){var o={};ee(R,o),localStorage.setItem("jv_loader_info_"+m,Te(o))}}function ee(t,o){Object.keys(t).forEach(function(e){(function(e){if(te(e))return!0;if("object"==typeof e){for(var t=Object.keys(e),o=0;o<t.length;o++)if(!te(e[t[o]]))return!1;return!0}})(t[e])||(o[e]=t[e])})}function te(e){return null===e&&"object"==typeof e}function oe(){var e=i.location&&i.location.protocol;return-1===["http","https"].indexOf(e||"")&&(e="https:"),e}function ne(){var e="";return R.configUpdatedTs&&(e="?v="+R.configUpdatedTs),oe()+v+"/script/widget/config/"+m+e}function re(){p=a.currentScript?a.currentScript:a.querySelector("script[jv-id]")||a.querySelector("script[data-jv-id]");var e,t=function(){if(p)return p.src;try{throw new Error("Get script URL")}catch(e){var t=e.stack;if(t){var o=ie(t),n=ae(t),r=se(t);return o?o[0]:n?n[0]:r?r[0]:null}}}(),o=ie(t),n=ae(t),r=se(t);v||(o?(v="//"+o[1],M=!0):n?v="//"+n[1]:r&&(v="//"+r[1])),m||(n&&n[2]?(m=n[2],M=!1):r&&r[2]?(m=r[2],M=!1):(M=!0,p&&(m=p.getAttribute("jv-id")||p.getAttribute("data-jv-id")),m||(e=t.match(/https?:\/\/\S+\/widget\/([A-Za-z0-9]+)/),m=e?e[1]:null)))}function ie(e){return e&&e.match(/https?:\/\/(\S+\.com)\/(widget\.js|widget\/[A-Za-z0-9]+)/)}function ae(e){return e&&e.match(/https?:\/\/(\S+)\/script\/widget\/([A-Za-z0-9]+)/)}function se(e){return e&&e.match(/https?:\/\/(\S+)\/script\/geo-widget\/([A-Za-z0-9]+)/)}function le(e,t,o){return{widgetId:e,region:t,clientLocation:o}}function de(e){if("string"==typeof e&&""!==e){var t=e.split(";");return{country:t[0],region:t[1],city:t[2]}}}function ce(){_e("Widget was removed",m),$("configHost",null),R.geoWidgetInfo.widgetId||R.isChatStarted?($("geoWidgetInfo",le(null,null,null)),$("isChatStarted",null),fe()):($("deletedInfo",{widgetId:m,resolveTime:((new Date).getTime()+T).toString()}),s.error("Widget "+m+" is permanently removed. Host: "+v),J("widget_deleted"))}function ue(){_e("Config loading error"),$("geoWidgetInfo",le(null,null,null)),$("isChatStarted",null),$("configHost",null),fe()}function fe(){v=m=null,re(),G(ne())}function ge(e){if(e)return e.type="text/javascript",e.async=!0,e.charset="UTF-8",h&&e.setAttribute("nonce",h),e}function ve(e){return e.responseType&&"text"!==e.responseType?"document"===e.responseType?e.responseXML:e.response:e.responseText}function me(t){var e=Object.keys(A),o=null;return e.forEach(function(e){o||-1!==A[e].indexOf(t)&&(o=e)}),o}function pe(){var e=R.availableHostInfo;return R.buildNumber===l.build_number&&e.host}function he(e){var t=e?"":B;if(!l.static_host)return l.base_url;if(O)return l.static_host;var o=!1;if(!e&&R.availableHostInfo&&R.availableHostInfo.host){var n=R.availableHostInfo.host.split("/");(n[3]?"/"+n[3]:"")!==B&&(o=!0)}return pe()&&!o?R.availableHostInfo.host:0===N?(r=me(k),L[r]+t):1===N?(r=function e(t,o){var n=Object.keys(t);var r=(i=n,i[Math.floor(Math.random()*i.length)]);var i;return r===o?e(t,o):r}(A,r),L[r]+t):l.base_url}function be(e,t,o){if(clearTimeout(u),++N>=I){if(_e("Bundle load retries count is exceeded"),_e("Bad csp is: "+W),W)return void s.error("Widget not loaded due CSP security policy.");var n=new Error("Bundle NOT loaded. Type: "+e+(t?". Host: "+t:"")+(o?". Status code: "+o:""));i.__jivoOnError(n)}else{var r={type:e,retriesCount:N,host:null};R.availableHostInfo=r,z()}}function we(e,t,o){var n;e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent&&(e.attachEvent("on"+t,(n=e,function(){o.call(n,i.event)})),e=null)}function _e(){if(R.log){var e=Array.prototype.slice.call(arguments||[]);e.unshift("Loader:"),s.log.apply(s,e)}}function ye(){var e=a.head||a.getElementsByTagName("head")[0];if(!e)throw s.error("Cannot get document head element"),new Error("Cannot get document head element");return e}function Se(e){return-1!==n.indexOf(e)}function je(){return Se("chrome")&&!Se("opr/")&&"Google Inc."===i.navigator.vendor}function Ie(){return!Se("windows")&&Se("android")}function Ce(e){try{return i.MooTools&&void 0===JSON.parse?JSON.decode(e):JSON.parse(e)}catch(e){return null}}function Te(e){return i.MooTools&&void 0===JSON.stringify?JSON.encode(e):JSON.stringify(e)}}var o=t,e=null;if(window.__hasStorage){try{e=JSON.parse(localStorage.getItem("__jivoLoader"))}catch(e){e.message="Loader parse error",window.__jivoOnError(e)}e&&.1<e.version&&(o=new Function("window","document","broswerCacheLoaderVersion","currentLoaderVersionCache","("+e.code+")(window, document, broswerCacheLoaderVersion, currentLoaderVersionCache)"))}try{o(window,document,.1,e?e.version:.1)}catch(e){e.message=e.message?"Loader error. "+e.message:"Loader error",window.__jivoOnError(e),delete window.jivo_magic_var,(o=t)(window,document,.1,.1)}}();